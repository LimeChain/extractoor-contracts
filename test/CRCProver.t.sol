// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import "../src/CRCProver.sol";
import {RLPReader} from "Solidity-RLP/RLPReader.sol";

contract CRCProverTest is Test {
    using RLPReader for bytes;
    using RLPReader for RLPReader.RLPItem;

    event MessageSent(address indexed sender, bytes32 indexed hash, uint256 messageIndex);

    CRCProver public prover;

    function setUp() public {
        prover = new CRCProver();
    }

    function testProve() public {
        address target = 0x058A39bEFBBA6a41e1CcBE97C3457dcc894B0fF2;
        bytes32 stateRoot = 0x16f6500b73f2a507557117d7572ab204f6b1de3b240f7d47c6d808e8455e92e0;
        bytes[] memory accountProof = new bytes[](8);
        accountProof[0] =
            hex"f90211a037c79fda4abfe4f8e9403f2a4635aef890a9edd70a69bdd6d1964d0ffb8ccdfca09c31bfe652357f7ebe7eb757c5177f6ce156da8bd92069603e2265b4914a262ea0f063fc61728bb23f65c4bfea6f7ad2e57cd56e4454db90b8e88a71a5b16a736ea0be0f8f699c4114445980552ab3d7efe3e9eef579ab19639c8681fa34ea983c04a067b04ebd5832a22013653cfa3ebb9b904c14d7262185717612ec9fff283b4c36a07f59dd6bf2694146c6ceb25f9a43d0de9601ab02f6d3b23e763e6aa8bf31366fa0d16e56dbda739c10c94197ea4ca33aebd1211ac53f7d350006d2c23d2b40cb84a0103456585a051fb10985117f57b560926b38466cc22ffcd08844a5fed5964a9ba0e33068c7cba0457630dffb2c32608a06030d2b0fecb3be08f259aff5c39434d0a099adae0f41b1ab31fad1916cabeafb0d2e5f347e83b0945298d532ab4a9ae84aa068049989cd54f567aed3727fa7c3fbcd0e6ef2d0accefaa4ddfbf820ab778576a0526069973c5a5f5a7e7552ca60e4e5325ed572e52edb0fe9849498caa29941c9a04e126496e6696e75736a531f5bce22f9ee1be6b559b83f3cf7c0ef79efdf2c33a01b06b19124d4753761c2288b989801086872983c5bc29453a987e33d2cf738d7a033d3d6f82853280b26ec561f94a0014914c97517a1e57ad1d62d3fbbc0105103a02c74c0831271964717668209f5772c6ef5e5024ccc9fc022a5787e281225473880";
        accountProof[1] =
            hex"f90211a09248d8f9b2a3cc47fa55849381b97010115f3bc21c623e6be491495300ff9daea04ba90bd52af41e64ceac339d4f36ca44ee92d2376a48d64376f46244e0b5d70fa0c0f598e46427bd56cbdb39a7fc679c93b051ece2dc457e40ecd9c7a510778242a086ff29669ef7b6c0bc4fabf99002d4c12e9f39ab92ec1d419e46a4e45ea0d65aa04a31218f365ea3a02a617b93b70f9ccda2f1508d58ea5d3a8546bcb88908a73ca042e5bd2ea5c11ed289cfa15ac81c133b9786a006936b1ff9209d40852c568e45a0433587be3a5f4d0979f15d7274f31d2cf64c7afc77bc80c42a4d567c8b36367ca046b67b36949f3f8d508aaed425c212b9ac8e1dc1c9f3594b5bb6e5d449303cafa0e3ed2d09cae85c42aff9c7b86065861a42bc04e023aa43460325efba3e8be553a08eeb94dd0b65cc1eac15003dd3128a826351f42d15a66c9070008aedd786e8eba0f88662e4c863b5f54a1eef09c31ac08e3d7d04e4803c12106c430e287bf04475a08b93f623e7b2dc90bcc813b86f41fad6f0c1c81be959cb07c049ef905747355fa005773c49c6715cad86d55bcc3b2e1d5c94377a5a136997d9bd47a0a0c5832b62a0db26bc14f70c37a29a0a35afcb0f2ce3646c76cefa51346b58e1754a8662b8b2a0b5830339fd538065eda068b6d063f615816bf4c241eb94c35e5262168ae4ef2ea036fb5fbf357749fbe9913a6d58ba927486a8f0813d338cdec5538365e6fca49280";
        accountProof[2] =
            hex"f90211a0532a7f4247cae890c5f9246a4625772cfa2f82b483ba8798077ec6ce7fc5f2d2a0191b6247ba37462ed88b3e3b16783ee5d7e422c75ff68ed1430df5f45fccd7cda0f8fa703c74f82e6167e2c3a2ad5c19ac945d19c94b750ef584db9d298218990ea05313f12bfb3df2b7f73cb42801a622d26b9401830b3b2d9b06cee830d3dcc881a0923e6e7c952499c8905468d1777e8ebaaa2960536b13d19a3af21f1883dd526ea064d5e2951311411005361c64e17d332414814a8f8378c26d32ff1f67930d4ee6a0f2d3ca4eb394de79e9bc79fe92a17d22f0504e233e34f4c89d75a2b9102dd779a025899ce2f4f578e4c6ed747f56e14c32857e8c854dc01c3a8f476598f0e674eba0fd374a70daaab271ba4e49cf068f5cbc30727dafa8736f24283df71e7bceb6a2a09609c5a24a56c76e353ad45d52075fa0445d1a6b2f96d7a03d13401732e39247a07c3cd2c7207b2d0292259ea381170c8f7e203d8a34a1de49237e51e4ee4a1ae2a0f443ccc9471747f5af2af1fcaa79190e41d27c961116cc986e7fde0bb6afee03a026a7e5d09b26d72863bc9b4e9171ef2eeebd8d35caf8c98a53388084e2ade335a06e909fa78c86ff72687b272f7b79099dfdeed4ad2dec7445811df13b71aac234a0ecc374f1dbb6eabb02adc9088454494688fdde876c87dc0dd5bc22bb75cbf992a0db18394599bb701b2491bc333d4d24f3456b243558da2a689ecaf70242972ea680";
        accountProof[3] =
            hex"f90211a0f890002cb615dba4f11d32fc95a217b9defb969379b4425d9bbdff4925c106f4a052ce25f3b6bf8d09a7cefe257c80a2412155080fc5e903a45a0fff29b354c953a06e99e9f31584c9ef0b7b58115c1a7d615de41b9db6b493a8b0157a7ce3ee6da1a001f03b64f2d586fa16b9287e5c318e121b27ee0ec374395bb38327997dd4031ea08d989206b2b1ffecefbd02707ba134ff7448cdea62a817d896c3bc25e713c46ca04fda22d8724303a0820aea524ee15adbb4d063755c68374b8bebd167e58459c9a050012a2da3b774b7e8b5cb10fbd224759bf1ede01f339a0fbe360ff10b5b4910a072ff9bb2fb0ef6d879388aab6891fbc71f4643ed3e49525ebf720219a6cc2036a0abe793e543d3b0e84fc337dd8207b3427c29d75497424217f52a559c3b88c14ba0e1dd73c5861a5347737b0072fffa19109b70c49f6c1a1ae23643e08927ef2432a0b412b0f1100f68e5b50b259e993a848fcad7b757fa6a226b1e9001784ab03858a072791caff84268e7304359b7e8aad39fd1fdc7700227a470b125903ffb0fd02ca03f92dab54762eb6b5ae13b20d1cddf737292bac0009acfb2343427dae927d11ba0f60bb3578d9f4aa2cd11e0e18047fb73fb1415ba781a9453aaf2f8127994d054a0f3c443f3f6b76698c77db0121a061c2b5ccc5d1922bee5d91c60099fab2748aca06a0d1d2724c3e7655a35b79fd65720d53ce13d005e7150b7e2a7eda82e67845580";
        accountProof[4] =
            hex"f90211a0c298cbd5e05cca072734fdccd479ef9f66a07a9c2cbee909d9c1d36323e36517a01b000df5f1db3808910a3b12b85583d6cbc91ea22a4b02a4d751344f20e6f728a0c4fe51d3e0ebbe08f7a2bb96e72933d32ee388314b9919f706b4ea2cae7c81b2a0d6c5ea56cbfb30a464219e9bfe08e760897c1528edf54ffeb1f704cac07b679fa0d5178f14aebb189f41562e239cdac82ec57633ce76216cbf928353f46be45479a0cd11e8a1825a6ca5748daeced11ece28dd021750f74478356602cec6e6161650a09105b2600b97b32daea6f2d95d44bdf0cfc081c7e69cd81ed89180c124146ffba0685adb0f8fd50e97bcf75ee99581f468924c862b103edb5ba570993c85cfce3fa057a8663711f30173eb1f5eafaa369c749a2cff123cfb724fc9e8f80703f2e0cfa005fcddd1eaf4ef6f944376501760aba7e951d55c0c791b9e4aa4fcd8745ce5a8a0f1ef47813cfeed87a28760ba1be155652fb4ad2768c854011287d31f39c3dab6a07fdf6b6d248ca616148210b6a464983c94995e66b0e77f1f8b35d688b1efaedea0a43816685cbdc32c566572785cfb80d02ed6629a70dde5c5e849125ad94598aaa033659dbc169eace35715e1377d9956b58008f0810a3b617401bfde4ed721a9a5a0bc9f49aaa009e96ce702e5cb501b71c6c4ae73671161b69133c78f568a4af5d1a04377e81168904e85020f993e758881d47d3f4370aae9aa302ec8917ed196922780";
        accountProof[5] =
            hex"f901118080808080a012a95d9fda505b9c5cca50c1c54b1a73965f786eabc1c0e747f1a868591ce956a0bdcc23dbe09fdff2845ef4c1c71bf63af96ac40684cc3578895068e96f574c6ca021334143033d53025e61105c27c69a4f812c26bd163a0e43f2aaf17429c946efa0f2566fc166e724931ead36585b4ccea10b91efe58681179a05bb277d4ecfd4ed80a039b55452cbacc004a2484c05f6b3f2f3a463ba4db918f7b4fc5d5c324d8e27f880a07b16363538955224b1596e55dc2df5e2a5cf1855761cfeebe7b7c2bf10cf162e80a0884fa2acc80677d35e425782dc0dca97f07186d1b6ccfe08573bae56942f9ceaa04b1f442c922add054b7b7cf89708367d121fd17f3d3a443496f1dbc4146a3db280";
        accountProof[6] =
            hex"f8518080808080808080808080a0727b7a92bb927f614141e02d88023c3e14e60f8f1a12defc0dc74b880d3f1cd5808080a0a304cce2d775eae9357bc98003d8eb5b6a06925ac6afa27a688481ddecccf00780";
        accountProof[7] =
            hex"f8669d39e0bf66655aba83980f041431c9f4ca7b82068f134912ec3232d0c2a5b846f8440180a09c1bbadf2df00d54d36e695f2ecdc0a5072ea237070e8ab0283ae61a57d1f5cba02233d911cc823f0101eb22c361aebe50c750cc0c4e19d94eaee21e6aa3e334e5";

        prover.verifyProof(stateRoot, target, accountProof);
    }
}

/* Example Proof
Target: 0x058A39bEFBBA6a41e1CcBE97C3457dcc894B0fF2
State Root: 0x16f6500b73f2a507557117d7572ab204f6b1de3b240f7d47c6d808e8455e92e0
Proof: ["0xf90211a037c79fda4abfe4f8e9403f2a4635aef890a9edd70a69bdd6d1964d0ffb8ccdfca09c31bfe652357f7ebe7eb757c5177f6ce156da8bd92069603e2265b4914a262ea0f063fc61728bb23f65c4bfea6f7ad2e57cd56e4454db90b8e88a71a5b16a736ea0be0f8f699c4114445980552ab3d7efe3e9eef579ab19639c8681fa34ea983c04a067b04ebd5832a22013653cfa3ebb9b904c14d7262185717612ec9fff283b4c36a07f59dd6bf2694146c6ceb25f9a43d0de9601ab02f6d3b23e763e6aa8bf31366fa0d16e56dbda739c10c94197ea4ca33aebd1211ac53f7d350006d2c23d2b40cb84a0103456585a051fb10985117f57b560926b38466cc22ffcd08844a5fed5964a9ba0e33068c7cba0457630dffb2c32608a06030d2b0fecb3be08f259aff5c39434d0a099adae0f41b1ab31fad1916cabeafb0d2e5f347e83b0945298d532ab4a9ae84aa068049989cd54f567aed3727fa7c3fbcd0e6ef2d0accefaa4ddfbf820ab778576a0526069973c5a5f5a7e7552ca60e4e5325ed572e52edb0fe9849498caa29941c9a04e126496e6696e75736a531f5bce22f9ee1be6b559b83f3cf7c0ef79efdf2c33a01b06b19124d4753761c2288b989801086872983c5bc29453a987e33d2cf738d7a033d3d6f82853280b26ec561f94a0014914c97517a1e57ad1d62d3fbbc0105103a02c74c0831271964717668209f5772c6ef5e5024ccc9fc022a5787e281225473880","0xf90211a09248d8f9b2a3cc47fa55849381b97010115f3bc21c623e6be491495300ff9daea04ba90bd52af41e64ceac339d4f36ca44ee92d2376a48d64376f46244e0b5d70fa0c0f598e46427bd56cbdb39a7fc679c93b051ece2dc457e40ecd9c7a510778242a086ff29669ef7b6c0bc4fabf99002d4c12e9f39ab92ec1d419e46a4e45ea0d65aa04a31218f365ea3a02a617b93b70f9ccda2f1508d58ea5d3a8546bcb88908a73ca042e5bd2ea5c11ed289cfa15ac81c133b9786a006936b1ff9209d40852c568e45a0433587be3a5f4d0979f15d7274f31d2cf64c7afc77bc80c42a4d567c8b36367ca046b67b36949f3f8d508aaed425c212b9ac8e1dc1c9f3594b5bb6e5d449303cafa0e3ed2d09cae85c42aff9c7b86065861a42bc04e023aa43460325efba3e8be553a08eeb94dd0b65cc1eac15003dd3128a826351f42d15a66c9070008aedd786e8eba0f88662e4c863b5f54a1eef09c31ac08e3d7d04e4803c12106c430e287bf04475a08b93f623e7b2dc90bcc813b86f41fad6f0c1c81be959cb07c049ef905747355fa005773c49c6715cad86d55bcc3b2e1d5c94377a5a136997d9bd47a0a0c5832b62a0db26bc14f70c37a29a0a35afcb0f2ce3646c76cefa51346b58e1754a8662b8b2a0b5830339fd538065eda068b6d063f615816bf4c241eb94c35e5262168ae4ef2ea036fb5fbf357749fbe9913a6d58ba927486a8f0813d338cdec5538365e6fca49280","0xf90211a0532a7f4247cae890c5f9246a4625772cfa2f82b483ba8798077ec6ce7fc5f2d2a0191b6247ba37462ed88b3e3b16783ee5d7e422c75ff68ed1430df5f45fccd7cda0f8fa703c74f82e6167e2c3a2ad5c19ac945d19c94b750ef584db9d298218990ea05313f12bfb3df2b7f73cb42801a622d26b9401830b3b2d9b06cee830d3dcc881a0923e6e7c952499c8905468d1777e8ebaaa2960536b13d19a3af21f1883dd526ea064d5e2951311411005361c64e17d332414814a8f8378c26d32ff1f67930d4ee6a0f2d3ca4eb394de79e9bc79fe92a17d22f0504e233e34f4c89d75a2b9102dd779a025899ce2f4f578e4c6ed747f56e14c32857e8c854dc01c3a8f476598f0e674eba0fd374a70daaab271ba4e49cf068f5cbc30727dafa8736f24283df71e7bceb6a2a09609c5a24a56c76e353ad45d52075fa0445d1a6b2f96d7a03d13401732e39247a07c3cd2c7207b2d0292259ea381170c8f7e203d8a34a1de49237e51e4ee4a1ae2a0f443ccc9471747f5af2af1fcaa79190e41d27c961116cc986e7fde0bb6afee03a026a7e5d09b26d72863bc9b4e9171ef2eeebd8d35caf8c98a53388084e2ade335a06e909fa78c86ff72687b272f7b79099dfdeed4ad2dec7445811df13b71aac234a0ecc374f1dbb6eabb02adc9088454494688fdde876c87dc0dd5bc22bb75cbf992a0db18394599bb701b2491bc333d4d24f3456b243558da2a689ecaf70242972ea680","0xf90211a0f890002cb615dba4f11d32fc95a217b9defb969379b4425d9bbdff4925c106f4a052ce25f3b6bf8d09a7cefe257c80a2412155080fc5e903a45a0fff29b354c953a06e99e9f31584c9ef0b7b58115c1a7d615de41b9db6b493a8b0157a7ce3ee6da1a001f03b64f2d586fa16b9287e5c318e121b27ee0ec374395bb38327997dd4031ea08d989206b2b1ffecefbd02707ba134ff7448cdea62a817d896c3bc25e713c46ca04fda22d8724303a0820aea524ee15adbb4d063755c68374b8bebd167e58459c9a050012a2da3b774b7e8b5cb10fbd224759bf1ede01f339a0fbe360ff10b5b4910a072ff9bb2fb0ef6d879388aab6891fbc71f4643ed3e49525ebf720219a6cc2036a0abe793e543d3b0e84fc337dd8207b3427c29d75497424217f52a559c3b88c14ba0e1dd73c5861a5347737b0072fffa19109b70c49f6c1a1ae23643e08927ef2432a0b412b0f1100f68e5b50b259e993a848fcad7b757fa6a226b1e9001784ab03858a072791caff84268e7304359b7e8aad39fd1fdc7700227a470b125903ffb0fd02ca03f92dab54762eb6b5ae13b20d1cddf737292bac0009acfb2343427dae927d11ba0f60bb3578d9f4aa2cd11e0e18047fb73fb1415ba781a9453aaf2f8127994d054a0f3c443f3f6b76698c77db0121a061c2b5ccc5d1922bee5d91c60099fab2748aca06a0d1d2724c3e7655a35b79fd65720d53ce13d005e7150b7e2a7eda82e67845580","0xf90211a0c298cbd5e05cca072734fdccd479ef9f66a07a9c2cbee909d9c1d36323e36517a01b000df5f1db3808910a3b12b85583d6cbc91ea22a4b02a4d751344f20e6f728a0c4fe51d3e0ebbe08f7a2bb96e72933d32ee388314b9919f706b4ea2cae7c81b2a0d6c5ea56cbfb30a464219e9bfe08e760897c1528edf54ffeb1f704cac07b679fa0d5178f14aebb189f41562e239cdac82ec57633ce76216cbf928353f46be45479a0cd11e8a1825a6ca5748daeced11ece28dd021750f74478356602cec6e6161650a09105b2600b97b32daea6f2d95d44bdf0cfc081c7e69cd81ed89180c124146ffba0685adb0f8fd50e97bcf75ee99581f468924c862b103edb5ba570993c85cfce3fa057a8663711f30173eb1f5eafaa369c749a2cff123cfb724fc9e8f80703f2e0cfa005fcddd1eaf4ef6f944376501760aba7e951d55c0c791b9e4aa4fcd8745ce5a8a0f1ef47813cfeed87a28760ba1be155652fb4ad2768c854011287d31f39c3dab6a07fdf6b6d248ca616148210b6a464983c94995e66b0e77f1f8b35d688b1efaedea0a43816685cbdc32c566572785cfb80d02ed6629a70dde5c5e849125ad94598aaa033659dbc169eace35715e1377d9956b58008f0810a3b617401bfde4ed721a9a5a0bc9f49aaa009e96ce702e5cb501b71c6c4ae73671161b69133c78f568a4af5d1a04377e81168904e85020f993e758881d47d3f4370aae9aa302ec8917ed196922780","0xf901118080808080a012a95d9fda505b9c5cca50c1c54b1a73965f786eabc1c0e747f1a868591ce956a0bdcc23dbe09fdff2845ef4c1c71bf63af96ac40684cc3578895068e96f574c6ca021334143033d53025e61105c27c69a4f812c26bd163a0e43f2aaf17429c946efa0f2566fc166e724931ead36585b4ccea10b91efe58681179a05bb277d4ecfd4ed80a039b55452cbacc004a2484c05f6b3f2f3a463ba4db918f7b4fc5d5c324d8e27f880a07b16363538955224b1596e55dc2df5e2a5cf1855761cfeebe7b7c2bf10cf162e80a0884fa2acc80677d35e425782dc0dca97f07186d1b6ccfe08573bae56942f9ceaa04b1f442c922add054b7b7cf89708367d121fd17f3d3a443496f1dbc4146a3db280","0xf8518080808080808080808080a0727b7a92bb927f614141e02d88023c3e14e60f8f1a12defc0dc74b880d3f1cd5808080a0a304cce2d775eae9357bc98003d8eb5b6a06925ac6afa27a688481ddecccf00780","0xf8669d39e0bf66655aba83980f041431c9f4ca7b82068f134912ec3232d0c2a5b846f8440180a09c1bbadf2df00d54d36e695f2ecdc0a5072ea237070e8ab0283ae61a57d1f5cba02233d911cc823f0101eb22c361aebe50c750cc0c4e19d94eaee21e6aa3e334e5"]*/
